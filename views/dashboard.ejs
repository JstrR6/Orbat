<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USM Dashboard</title>
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
    <%
    // Helper function to format Discord color codes
    function formatColor(color) {
        if (!color || color === 0) return '#000000'; // Default black if no color
        if (typeof color === 'string' && color.startsWith('#')) return color;
        const hex = typeof color === 'number' ? color.toString(16) : color;
        return `#${hex.padStart(6, '0')}`;
    }
    %>

    <div class="container">
        <div class="sidebar">
            <h2>USM Dashboard</h2>
            <a href="/dashboard" class="button">Dashboard</a>
            <a href="/forms" class="button">Forms</a>
            <a href="/orders" class="button">Orders</a>
        </div>
        <div class="main-content">
            <div class="top-bar">
                <h1>Welcome, <%= user.username %>!</h1>
                <div class="user-info">
                    <span><%= user.username %></span>
                    <img src="<%= user.avatar %>" alt="Avatar" class="user-avatar">
                    <a href="/logout" class="logout-btn">Logout</a>
                </div>
            </div>

            <div class="announcement-form">
                <h2>Create Announcement</h2>
                <form id="announcementForm" action="/post-announcement" method="POST">
                    <input type="text" id="announcementTitle" name="title" placeholder="Announcement Title" required>
                    <textarea id="announcementContent" name="content" placeholder="Announcement Content" required></textarea>
                    <button type="submit">Post Announcement</button>
                </form>
            </div>

            <div class="announcements">
                <h2>Announcements</h2>
                <div id="announcementsList">
                    <% announcements.forEach(function(announcement) { %>
                        <div class="announcement">
                            <h3><%= announcement.title %></h3>
                            <p><%= announcement.content %></p>
                            <small>Posted by <%= announcement.author %> on <%= announcement.date %></small>
                        </div>
                    <% }); %>
                </div>
            </div>

            <div class="guilds-section">
                <h2>Your Servers</h2>
                <% user.guilds.forEach(function(guild) { %>
                    <div class="guild-card">
                        <h3><%= guild.name %></h3>
                        <% if (guild.memberInfo && guild.memberInfo.roles) { %>
                            <h4>Your Roles:</h4>
                            <ul>
                                <% guild.memberInfo.roles.forEach(function(role) { %>
                                    <li style="color: <%= formatColor(role.color) || '#000000' %>">
                                        <%= role.name %> (Position: <%= role.position %>)
                                    </li>
                                <% }); %>
                            </ul>
                            <p>Highest Role: <%= guild.memberInfo.highestRole.name %></p>
                            <p style="color: <%= formatColor(guild.memberInfo.highestRole.color) || '#000000' %>">
                                Highest Role Color Example
                            </p>
                            
                        <% } else { %>
                            <p>No role information available</p>
                        <% } %>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>

    <script src="/js/dashboard.js"></script>
</body>
</html>
